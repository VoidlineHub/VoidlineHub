-- [[ 2. UI / WINDOWS SECTION ]] --
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local LP = Players.LocalPlayer
local PlayerGui = LP:WaitForChild("PlayerGui")

-- // WindUI Initialization
local WindUI
do
local ok, result = pcall(function()
return require("./src/Init")
end)
if ok then WindUI = result else
WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()
end
end

-- // Global Variables
_G.AutoFarmBarista = false
_G.AutoFarmCourier = false
_G.WebhookURL = ""
_G.WebhookEnabled = true
_G.AntiAFK = false
_G.HideNameEnabled = false
_G.HideCharEnabled = false
_G.AutoRejoin = false


--// STATE
local StartTime = nil
local TotalEarned = 0
local LastMoney = 0
local SelectedJob = "Civilian"

local WEBHOOK_INTERVAL = 50

local function FormatRupiah(num)
local s = tostring(num)
local result = s:reverse():gsub("(%d%d%d)", "%1."):reverse()
if result:sub(1,1) == "." then
result = result:sub(2)
end
return "Rp" .. result
end

--// CONFIG
_G.WebhookURL = _G.WebhookURL or ""

--// PLAYER DATA (NON LEADERSTATS)
local PlayerData = LP:WaitForChild("PlayerData")
local MoneyValue = PlayerData:WaitForChild("RPValue")

LastMoney = MoneyValue.Value
MoneyValue:GetPropertyChangedSignal("Value"):Connect(function()
local diff = MoneyValue.Value - LastMoney
if diff > 0 then
TotalEarned += diff
end
LastMoney = MoneyValue.Value
end)

--// FORMAT TIME
local function EnsureStartTime()
if not StartTime then
StartTime = os.time()
end
end

local function FormatTime(sec)
return string.format(
"%02d:%02d:%02d",
math.floor(sec / 3600),
math.floor((sec % 3600) / 60),
sec % 60
)
end

--// WEBHOOK FUNCTION
local function SendWebhook(isTest)
if _G.WebhookURL == "" or not _G.WebhookURL:find("https://discord.com/api/webhooks/") then
return
end

if not isTest and not _G.WebhookEnabled then
return
end

local payload

if isTest then
payload = {
username = "VoidlineHub",
avatar_url = "https://cdn.discordapp.com/attachments/1464981605486694695/1466048679239487705/IMG_20260125_124614.jpg",
embeds = {{
title = "‚úÖ Webhook Test Successful",
description = "webhook successfully ready to use.",
color = 5763719,
thumbnail = {
url = "https://cdn.discordapp.com/attachments/1464981605486694695/1466048679239487705/IMG_20260125_124614.jpg"
}
}}
}
else
EnsureStartTime()

local runtimeSec = os.time() - StartTime
local estPerHour = runtimeSec > 0 and math.floor((TotalEarned / runtimeSec) * 3600) or 0

payload = {
username = "VoidlineHub",
avatar_url = "https://cdn.discordapp.com/attachments/1464981605486694695/1466048679239487705/IMG_20260125_124614.jpg",
embeds = {{
title = "üìå Jobs Data Report",
color = 2067276,
thumbnail = {
url = "https://cdn.discordapp.com/attachments/1464981605486694695/1466048679239487705/IMG_20260125_124614.jpg"
},
fields = {
{
name = "üß∞ Job Select",
value = "" .. (       _G.AutoFarmBarista and "Barista"       or _G.AutoFarmCourier and "Courier"       or "Idle"       ) .. "",
inline = false
},
{
name = "‚è± Running Time",
value = "" .. FormatTime(runtimeSec) .. "",
inline = true
},
{
name = "üí∞ Total Earning",
value = "" .. FormatRupiah(TotalEarned) .. "",
inline = true
},
{
name = "üìà Est. Income / Hour",
value = "" .. FormatRupiah(estPerHour) .. "",
inline = true
},
{
name = "üíµ Current Money",
value = "" .. FormatRupiah(MoneyValue.Value) .. "",
inline = false
}
},
footer = { text = "VoidlineHub System" },
timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
}}
}

end

local req = syn and syn.request or http_request or request
if req then
req({
Url = _G.WebhookURL,
Method = "POST",
Headers = { ["Content-Type"] = "application/json" },
Body = HttpService:JSONEncode(payload)
})
end

end

--// REALTIME LOOP (ANTI SPAM)
task.spawn(function()
while task.wait(WEBHOOK_INTERVAL) do
SendWebhook(false)
end
end)

-- // Window
local Window = WindUI:CreateWindow({
Title = "VoidlineHub | free version.",
Folder = "adadeh",
Icon = "rbxassetid://124846601689213",
NewElements = true,
Size = UDim2.fromOffset(300, 350),
OpenButton = { Title = "VoidlineHub", Enabled = true, Draggable = true, Color = ColorSequence.new(Color3.fromHex("#30FF6A"), Color3.fromHex("#e7ff2f")) },
Topbar = { Height = 44, ButtonsType = "Mac" },
})

-- // TAB: HOME
local HomeTab = Window:Tab({ Title = "Home", Icon = "house" })

HomeTab:Section({ Title = "Update Log" })
HomeTab:Button({
Title = "Version 1.0",
Desc = "[+]added new autofarm\n[+]added barista\n[+]webhook sistem\n[+]new ui",
Icon = "file-text"
})

HomeTab:Section({ Title = "Game Information" })
local GameTime = HomeTab:Button({
Title = "Job Status",
Desc = "Preparing...",
Icon = "activity"
})
local function SetGameStatus(text)
if GameTime and GameTime.Set then
GameTime:Set({ Desc = text })
end
end
local FpsLabel = HomeTab:Button({ Title = "Fps", Desc = "0 FPS", Icon = "monitor" })
local PingLabel = HomeTab:Button({ Title = "Ping", Desc = "Calculating...", Icon = "signal" })
local CurrentMoney = HomeTab:Button({ Title = "current money", Desc = "Calculating...", Icon = "wallet" })

-- // SOCIAL LINKS
HomeTab:Section({ Title = "Social Links" })
HomeTab:Paragraph({ Title = "Discord Server", Desc = "Join community for updates." })
HomeTab:Button({
Title = "Copy Link",
Icon = "link",
Justify = "Center",
Callback = function()
setclipboard("https://discord.gg/5zHKMnA7KC")
WindUI:Notify({ Title = "Discord", Content = "Link copied!" })
end
})

HomeTab:Space()

HomeTab:Paragraph({ Title = "Tiktok Media", Desc = "Follow our Tiktok!" })
HomeTab:Button({
Title = "Copy Link",
Justify = "Center",
Callback = function()
setclipboard("tiktok.com/@billzzhub")
WindUI:Notify({ Title = "Tiktok", Content = "Link copied!" })
end
})

HomeTab:Section({ Title = "Current Status" })
HomeTab:Paragraph({
Title = "Activities",
Desc = "Barista: Waiting\nPolice: Waiting\nPause: Enabled"
})

local AutoFarmTab = Window:Tab({ Title = "Auto Farm", Icon = "car" })
AutoFarmTab:Section({ Title = "Barista" })
AutoFarmTab:Toggle({
Title = "Auto Farm Barista",
Value = false,
Callback = function(v)
_G.AutoFarmBarista = v
end
})
AutoFarmTab:Section({ Title = "Courier" })
AutoFarmTab:Toggle({ Title = "Autofarm courier", Locked = true, LockedTitle = "Soon" })
AutoFarmTab:Section({ Title = "Police" })
AutoFarmTab:Toggle({ Title = "Autofarm Police", Locked = true, LockedTitle = "Only Premium" })

local TeleportTab = Window:Tab({ Title = "Teleport", Icon = "map" })
TeleportTab:Section({ Title = "Teleport Dealer" })

-- =========================
-- VOID TWEEN TELEPORT (DEALER)
-- =========================
local function getHRP()
local char = LP.Character or LP.CharacterAdded:Wait()
return char:WaitForChild("HumanoidRootPart")
end

local function VoidTweenTo(targetCF)
local hrp = getHRP()
local VOID_Y = -30
local SPEED = 180

-- turun ke void
local downTween = TweenService:Create(
hrp,
TweenInfo.new(0.5, Enum.EasingStyle.Sine),
{ CFrame = hrp.CFrame * CFrame.new(0, VOID_Y, 0) }
)
downTween:Play()
downTween.Completed:Wait()

-- jalan horizontal di void
local targetVoid = CFrame.new(targetCF.X, VOID_Y, targetCF.Z)
local dist = (hrp.Position - targetVoid.Position).Magnitude

local moveTween = TweenService:Create(
hrp,
TweenInfo.new(dist / SPEED, Enum.EasingStyle.Linear),
{ CFrame = targetVoid }
)
moveTween:Play()
moveTween.Completed:Wait()

-- naik ke permukaan
TweenService:Create(
hrp,
TweenInfo.new(0.5, Enum.EasingStyle.Sine),
{ CFrame = targetCF + Vector3.new(0, 2, 0) }
):Play()

end

local Locations = {
["Luxury"] = CFrame.new(-4810, 6, -771),
["Sizuki"] = CFrame.new(-4819, 6, -771),
["Yahamax"] = CFrame.new(709, 4, -736),
["Police"] = CFrame.new(2823, 5, -829),
["Trucks"] = CFrame.new(-10248, 7, 1304),
["Cars"] = CFrame.new(-6605, 5, -4211),
["DragSpec"] = CFrame.new(-5005, 4, -5351),
["Vespero"] = CFrame.new(-5753, 6, -3896),
["Hando"] = CFrame.new(-5956, 6, -3898)
}

TeleportTab:Dropdown({
Title = "Select Dealer",
Values = {"Luxury","Sizuki","Yahamax","Police","Trucks","Cars","DragSpec","Vespero","Hando"},
Callback = function(v)
_G.SelectTp = v
end
})

TeleportTab:Button({
Title = "Teleport",
Callback = function()
if _G.SelectTp and Locations[_G.SelectTp] then
VoidTweenTo(Locations[_G.SelectTp])
end
end
})

local VehicleTab = Window:Tab({ Title = "Vehicle", Icon = "car-front",  })
VehicleTab:Section({ Title = "Vehicle Config" })
VehicleTab:Input({ Title = "Max Force", Locked = true, LockedTitle = "Premium Only" })
VehicleTab:Input({ Title = "Increment", Locked = true, LockedTitle = "Premium Only" })
VehicleTab:Input({ Title = "Interval", Locked = true, LockedTitle = "Premium Only" })
VehicleTab:Section({ Title = "enable Config" })
VehicleTab:Toggle({ Title = "Enable Boost", Locked = true, LockedTitle = "Premium Only" })

VehicleTab:Toggle({ Title = "straight boost", Locked = true, LockedTitle = "Only Premium" })

local SettingTab = Window:Tab({ Title = "Settings", Icon = "settings" })

SettingTab:Section({ Title = "Character & UI" })

SettingTab:Toggle({
Title = "Hide Name",
Callback = function(v)
_G.HideNameEnabled = v
end
})

SettingTab:Toggle({
Title = "Hide Character",
Callback = function(v)
_G.HideCharEnabled = v
end
})

SettingTab:Button({
Title = "Reset Character",
Callback = function()
if LP.Character then
LP.Character:BreakJoints()
end
end
})

SettingTab:Section({ Title = "Automation" })

SettingTab:Toggle({
Title = "Auto Rejoin",
Value = true,
Callback = function(v)
_G.AutoRejoin = v
end
})

SettingTab:Toggle({
Title = "Anti AFK",
Value = true,
Callback = function(v)
_G.AntiAFK = v
end
})

SettingTab:Section({ Title = "Webhook Log" })
SettingTab:Input({ Title = "Webhook URL", Callback = function(v) _G.WebhookURL = v end })
SettingTab:Toggle({ Title = "Enable Webhook Log", Callback = function(v) _G.WebhookEnabled = v end })
SettingTab:Button({ Title = "Test Send Webhook", Callback = function() SendWebhook(true) end })

-- // LOGIC BARISTA
-- =========================================================
-- BARISTA GHOST MODE (REVISED: 6.5s HOLD + ANTI-STUCK)
-- =========================================================

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")

local LP = Players.LocalPlayer
local PlayerGui = LP:WaitForChild("PlayerGui")

-- STATE
_G.AutoFarmBarista = _G.AutoFarmBarista or false
_G.AntiAFK = true
local BaristaRunning = false
local isWorking = false

-- COORDINATES
local POS_EXIT_BARISTA = Vector3.new(-5004.42, 2.89, -678.09)
local POS_SUPPLY = Vector3.new(-5114.04, 2.89, -669.93)

-- PATHS
local BaristaJob = workspace:WaitForChild("BaristaJob")
local Interactions = BaristaJob:WaitForChild("Interactions")
local JobEvents = ReplicatedStorage:WaitForChild("JobEvents")
local TeamChangeRequest = JobEvents:WaitForChild("TeamChangeRequest")
local BaristaAssets = ReplicatedStorage:WaitForChild("BaristaAssets")
local BaristaEvent = BaristaAssets:WaitForChild("Events"):WaitForChild("BaristaEvent")

local startPart = Interactions.StartPart.StartPart
local machinePart = Interactions.MachinePart.MachinePart
local registerPart = Interactions.RegisterPart.RegisterPart
local supplyPart = Interactions.SupplyPart.SupplyPart

-- UTILS
local function getHRP()
    local char = LP.Character or LP.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

-- =========================================================
-- PERSISTENT AUTOWALK (ANTI-STUCK ENHANCED)
-- =========================================================
local function autoWalk(targetPos)
    local char = LP.Character
    local hum = char and char:FindFirstChild("Humanoid")
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hum or not hrp then return end
    
    hum.WalkSpeed = 19
    local lastPos = hrp.Position
    local stuckTick = 0
    
    repeat
        if not _G.AutoFarmBarista then break end
        hum:MoveTo(targetPos)
        
        task.wait(0.2)
        -- Jika posisi macet (nyangkut meja/dinding)
        if (hrp.Position - lastPos).Magnitude < 0.5 then
            stuckTick = stuckTick + 1
            if stuckTick >= 3 then -- Lebih responsif (0.6 detik macet langsung lompat)
                hum.Jump = true 
                stuckTick = 0
            end
        else
            stuckTick = 0
        end
        lastPos = hrp.Position
    until (hrp.Position - targetPos).Magnitude < 3.8
end

-- =========================
-- HOLD CLICK SYSTEM
-- =========================
local function holdClick(prompt)
    if not prompt or not prompt.Enabled then return end
    
    task.wait(0.5) 
    prompt:InputHoldBegin()
    -- Ambil durasi hold asli atau default
    local duration = prompt.HoldDuration > 0 and prompt.HoldDuration or 0.3
    task.wait(duration + 0.2)
    prompt:InputHoldEnd()
    
    fireproximityprompt(prompt)
    task.wait(0.5) 
end

-- =========================================================
-- REPAIR LOGIC (SUPPLY HOLD 6.5s + FIX EXIT)
-- =========================================================
local function runRepairFlow()
    local missionUI = PlayerGui:FindFirstChild("BaristaMissionUI")
    local label = missionUI and missionUI:FindFirstChild("ObjectiveLabel", true)
    
    if label then
        local text = label.Text:lower()
        if text:find("anomaly") or text:find("strange") or text:find("person") then return end

        if text:find("broke") or text:find("down") or text:find("fix") or text:find("restock") then
            isWorking = true
            
            -- OTW KE SUPPLY
            autoWalk(POS_EXIT_BARISTA)
            autoWalk(POS_SUPPLY)
            
            local prompt = supplyPart:FindFirstChild("SupplyPrompt")
            if prompt then
                task.wait(1.0)
                -- PAKSA HOLD MANUAL 6.5 DETIK (BIAR GAK KEDETEKSI)
                prompt:InputHoldBegin()
                print("‚è≥ Holding Supply for 6.5 seconds...")
                task.wait(6.5) 
                prompt:InputHoldEnd()
                
                -- BARU TEMBAK REMOTE SETELAH HOLD SELESAI
                BaristaEvent:FireServer("RestockSupplies")
                fireproximityprompt(prompt)
            end
            
            task.wait(1.0) 
            
            -- BALIK KE EXIT (DENGAN FORCE JUMP BIAR GAK STUCK DI PINTU)
            autoWalk(POS_EXIT_BARISTA)
            task.wait(0.5)
            isWorking = false -- RESET STATE AGAR MACHINE BISA JALAN LAGI
        end
    end
end

-- =========================
-- MINIGAME & REGISTER (UR MODIFIED VERSION)
-- =========================
local function handleMinigame()
    local gui = PlayerGui:FindFirstChild("BaristaGUI")
    local mini = gui and gui:FindFirstChild("MinigameFrame")
    if not mini or not mini.Visible then return end

    isWorking = true
    pcall(function()
        local target = mini:WaitForChild("BackgroundBar"):WaitForChild("TargetZone")
        target.Size = UDim2.new(1.8, 0, 1.8, 0)
        target.Position = UDim2.new(-0.4, 0, -0.4, 0)
        target.BackgroundTransparency = 1 -- Sesuai modifikasi lu
    end)

    while mini.Visible and _G.AutoFarmBarista do task.wait(0.5) end
    
    -- Register Flow
    autoWalk(registerPart.Position)
    local regPrompt = registerPart:FindFirstChild("RegisterPrompt")
    if regPrompt then holdClick(regPrompt) end
    
    -- Balik ke Mesin
    autoWalk(machinePart.Position)
    isWorking = false
end

-- =========================
-- MAIN CONTROLLER
-- =========================
local function StartBaristaGhost()
    if BaristaRunning then return end
    BaristaRunning = true

    task.spawn(function()
        TeamChangeRequest:FireServer("Barista", 11378976, 1, 0, "Detector")
        task.wait(2.5)
        
        while _G.AutoFarmBarista do
            local missionUI = PlayerGui:FindFirstChild("BaristaMissionUI")
            
            -- 1. START JOB (TWEEN)
            if not missionUI and not isWorking then
                local hrp = getHRP()
                local targetCF = startPart.CFrame
                TweenService:Create(hrp, TweenInfo.new(0.5), {CFrame = CFrame.new(hrp.Position.X, -27, hrp.Position.Z)}):Play()
                task.wait(0.6)
                local dist = (hrp.Position - Vector3.new(targetCF.X, -27, targetCF.Z)).Magnitude
                local move = TweenService:Create(hrp, TweenInfo.new(dist/180), {CFrame = CFrame.new(targetCF.X, -27, targetCF.Z)})
                move:Play()
                move.Completed:Wait()
                TweenService:Create(hrp, TweenInfo.new(0.5), {CFrame = targetCF + Vector3.new(0,2,0)}):Play()
                task.wait(0.6)
                
                holdClick(startPart:FindFirstChild("JobPrompt"))
                
                task.wait(2)
                if _G.AutoFarmBarista and PlayerGui:FindFirstChild("BaristaMissionUI") then
                    autoWalk(machinePart.Position)
                end

            -- 2. REPAIR (DENGAN RESET STATE YG LEBIH TEGAS)
            elseif missionUI and not isWorking then
                local label = missionUI:FindFirstChild("ObjectiveLabel", true)
                if label and label.TextColor3 == Color3.fromRGB(255, 50, 50) then
                    runRepairFlow() 
                end
            end

            -- 3. WORK
            if missionUI and not isWorking then
                local gui = PlayerGui:FindFirstChild("BaristaGUI")
                local mini = gui and gui:FindFirstChild("MinigameFrame")

                if mini and mini.Visible then
                    handleMinigame()
                else
                    local hrp = getHRP()
                    -- Jika jauh dari mesin, jalan ke mesin
                    if (hrp.Position - machinePart.Position).Magnitude > 4 then
                        autoWalk(machinePart.Position)
                    else
                        local prompt = machinePart:FindFirstChild("MachinePrompt")
                        -- PAKSA HOLD BIAR AMAN
                        if prompt and prompt.Enabled then
                            holdClick(prompt)
                        end
                    end
                end
            end
            task.wait(0.5)
        end
        BaristaRunning = false
    end)
end

-- TOGGLE
task.spawn(function()
    while true do
        task.wait(0.5)
        if _G.AutoFarmBarista then StartBaristaGhost() end
    end
end)


-- =========================
-- SYSTEM LOOPS (FPS Counter)
-- =========================
local lastClock = os.clock()
local fpsCounter = 0
local fps = 0

RunService.Heartbeat:Connect(function()
fpsCounter += 1
if os.clock() - lastClock >= 1 then
fps = fpsCounter
fpsCounter = 0
lastClock = os.clock()
end
end)

-- =========================
-- FPS / PING LOOP (FIXED)
-- =========================
task.spawn(function()
    local fpsCounter = 0
    local currentFps = 0

    RunService.Heartbeat:Connect(function()
        fpsCounter += 1
    end)

    while true do
        task.wait(1)

        currentFps = fpsCounter
        fpsCounter = 0

        -- Update FPS
        if FpsLabel then
            FpsLabel:SetDesc(tostring(currentFps) .. " FPS")
        end

        -- Update Ping
        local ping = math.floor(LP:GetNetworkPing() * 1000)
        if PingLabel then
            PingLabel:SetDesc(tostring(ping) .. " ms")
        end
    end
end)
-- // HIDE NAME & CHARACTER LOOP (FIXED)
RunService.Heartbeat:Connect(function()
local char = LP.Character
if not char then return end

-- HIDE NAME
if _G.HideNameEnabled then
local head = char:FindFirstChild("Head")
local tag = head and head:FindFirstChildOfClass("BillboardGui")
if tag then
tag.Enabled = false
end
end

-- HIDE CHARACTER
if _G.HideCharEnabled then
for _, v in pairs(char:GetDescendants()) do
if v:IsA("BasePart") then
v.Transparency = 1
v.CanCollide = false
elseif v:IsA("Decal") then
v.Transparency = 1
end
end
end

end)

-- ANTI AFK FIXED
task.spawn(function()
    local VU = game:GetService("VirtualUser")
    while task.wait(60) do
        if _G.AntiAFK then
            VU:CaptureController()
            VU:ClickButton2(Vector2.new(0,0))
        end
    end
end)

print("üöÄ VoidlineHub Loaded with Adonis Bypass!")
 
